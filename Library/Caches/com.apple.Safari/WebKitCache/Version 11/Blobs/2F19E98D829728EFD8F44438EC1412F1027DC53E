function openDetailModal(b,a,c,d){var e=$J("#detailPanel"+b);hideLoad();if(!d){d="Detail"}e.dialog({autoOpen:true,title:d,resizable:false,height:"725",width:"825",modal:true,index:b,dialogClass:"detailDialog"+b,pageIndex:a})}var CheckoutsList=Class.create();CheckoutsList.prototype={initialize:function(c){this.selectBox="#"+c+" .checkoutsSelect";this.checkBoxes="#"+c+" .checkoutsCheckbox";this.renewButton="#"+c+"_checkoutsRenewButton";this.topRenewButton="#"+c+"_topCheckoutsRenewButton";this.returnButton="#"+c+"_checkoutsReturnButton";this.topReturnButton="#"+c+"_topCheckoutsReturnButton";this.confirmation="#"+c+"_checkoutsDialog";this.noneSelectedDialog="#"+c+"_noneSelectedDialog";this.noneSelectedButton="#"+c+"_noneSelectedButton";this.isClear=false;var b=this;$J(this.selectBox).click(function(d){if(b.isClear){$J(b.checkBoxes).each(function(e,f){if(!f.disabled){f.checked=""}});$J(b.selectBox).each(function(e,f){f.checked=""})}else{$J(b.checkBoxes).each(function(e,f){if(!f.disabled){f.checked="checked"}});$J(b.selectBox).each(function(e,f){f.checked="checked"})}b.isClear=!b.isClear});$J(this.checkBoxes).click(function(f){var d=true;$J(b.checkBoxes).each(function(e,g){if(!g.disabled&&g.checked==""){d=false}});if(d){$J(b.selectBox).each(function(e,g){g.checked="checked"});b.isClear=true}else{$J(b.selectBox).each(function(e,g){g.checked=""});b.isClear=false}});$J(this.noneSelectedDialog).dialog({autoOpen:false,modal:true,zIndex:1000});$J(this.confirmation).dialog({autoOpen:false,modal:true,zIndex:1000});$J(this.topRenewButton).click(function(d){a()});$J(this.renewButton).click(function(d){a()});$J(this.topReturnButton).click(function(d){a()});$J(this.returnButton).click(function(d){a()});var a=function(){var d=false;$J(b.checkBoxes).each(function(e,f){if(f.checked!=""){d=true}});if(d){$J(b.confirmation).dialog("open")}else{$J(b.noneSelectedDialog).dialog("open")}return false};$J(this.noneSelectedButton).click(function(d){$J(b.noneSelectedDialog).dialog("close")})}};function setupCheckoutsListDialog(e){var b="#"+e+"_checkoutsDialog";var c="#"+e+"_checkoutsDialogConfirm";var d="#"+e+"_checkoutsDialogCancel";var a="#"+e+"_submit_holder .hidden";$J(c).click(function(h){var g=$J(".loadingDiv");if(g.length<1){g=$J("<div></div>").addClass("loadingDiv");$J("#checkoutsAccordion").append(g)}var f=$J(".loadingBackdrop");if(f.length<1){f=$J("<div></div>").addClass("loadingBackdrop");$J("#checkoutsAccordion").append(f)}$J(b).dialog("close");f.show();g.show();createSpinnersForSelector(g);$J(a).click()});$J(d).click(function(f){$J(b).dialog("close")})}var HoldsList=Class.create();HoldsList.prototype={initialize:function(d,h,a,b,g,i,p){this.containerSelector="#"+d;this.selectBox="#"+d+" .holdsSelect";this.checkBoxes="#"+d+" .holdsCheckbox";this.readyCheckBoxes="#"+d+" .readyHoldsCheckbox";this.isClear=false;this.deleteButton="#"+d+"_deleteButton";this.topDeleteButton="#"+d+"_topDeleteButton";this.deleteConfirmButton="#"+d+"_deleteConfirm";this.deleteCancelButton="#"+d+"_deleteCancel";this.deleteDialog="#"+d+"_deleteDialog";this.editButton="#"+d+"_editButton";this.topEditButton="#"+d+"_topEditButton";this.editCancelButton="#"+d+"_editCancel";this.editConfirmButton="#"+d+"_editConfirm";this.editDialog="#placeHold";this.editSelect="#"+d+"_editSelect";this.suspendButton="#"+d+"_suspendButton";this.topSuspendButton="#"+d+"_topSuspendButton";this.suspendCancelButton="#"+d+"_suspendCancel";this.suspendConfirmButton="#"+d+"_suspendConfirm";this.cancelSuspendButton="#"+d+"_cancelSuspendButton";this.topCancelSuspendButton="#"+d+"_topCancelSuspendButton";this.cancelSuspendConfirmButton="#"+d+"_cancelSuspendConfirm";this.cancelSuspendCancelButton="#"+d+"_cancelSuspendCancel";this.suspendDialog="#"+d+"_suspendDialog";this.cancelSuspendDialog="#"+d+"_cancelSuspendDialog";this.suspendError="#"+d+"_suspendError";if(p){this.submitButton=this.containerSelector+" input[id^=ercHolds_holdslist_submit]"}else{this.submitButton=this.containerSelector+" input[id^=myHolds_holdslist_submit]"}this.formAction="#"+d+"_action_holder .hidden";this.libraryId="#"+d+"_libraryId_holder .hidden";this.startDate="#"+d+"_holdDates .startDate";this.endDate="#"+d+"_holdDates .endDate";this.noneSelectedDialog="#"+d+"_noneSelectedDialog";this.noneSelectedButton="#"+d+"_noneSelectedButton";this.nonCancelableDialog="#"+d+"_nonCancelableDialog";this.nonCancelableButton="#"+d+"_nonCancelableButton";this.nonEditableDialog="#"+d+"_nonEditableDialog";this.nonEditableButton="#"+d+"_nonEditableButton";this.dateFormat=b;this.editHoldsUrl=g;this.reloadUrl=i;var m=this;$J(this.selectBox).click(function(q){if(m.isClear){$J(m.checkBoxes).each(function(r,s){if(!s.disabled){s.checked=""}});$J(m.readyCheckBoxes).each(function(r,s){if(!s.disabled){s.checked=""}});$J(m.selectBox).each(function(r,s){if(!s.disabled){s.checked=""}})}else{$J(m.checkBoxes).each(function(r,s){if(!s.disabled){s.checked="checked"}});$J(m.readyCheckBoxes).each(function(r,s){if(!s.disabled){s.checked="checked"}});$J(m.selectBox).each(function(r,s){if(!s.disabled){s.checked="checked"}})}m.isClear=!m.isClear});$J(this.checkBoxes).click(function(q){c()});$J(this.readyCheckBoxes).click(function(q){c()});var c=function(){var q=true;$J(m.checkBoxes).each(function(r,s){if(!s.disabled&&s.checked==""){q=false}});$J(m.readyCheckBoxes).each(function(r,s){if(!s.disabled&&s.checked==""){q=false}});if(q){$J(m.selectBox).each(function(r,s){s.checked="checked"});m.isClear=true}else{$J(m.selectBox).each(function(r,s){s.checked=""});m.isClear=false}};$J(this.noneSelectedDialog).dialog({autoOpen:false,modal:true,zIndex:1000});$J(this.nonCancelableDialog).dialog({autoOpen:false,modal:true,zIndex:1000});$J(this.deleteDialog).dialog({autoOpen:false,modal:true,zIndex:1000});$J(this.deleteButton).click(function(q){f()});$J(this.topDeleteButton).click(function(q){f()});var n=function(){var q=false;m.docIds=new Array();$J(m.checkBoxes).each(function(r,t){if(t.checked!=""){q=true;for(var s=0;s<t.parentElement.children.length;s++){if(t.parentElement.children[s].id.indexOf("docId")!=-1){m.docIds.push(t.parentElement.children[s].innerHTML);break}}}});$J(m.readyCheckBoxes).each(function(r,t){if(t.checked!=""){q=true;for(var s=0;s<t.parentElement.children.length;s++){if(t.parentElement.children[s].id.indexOf("docId")!=-1){m.docIds.push(t.parentElement.children[s].innerHTML);break}}}});return q};var f=function(){if(n()){var q=true;if(!h){$J(m.readyCheckBoxes).each(function(r,s){if(s.checked!=""){q=false}})}if(q){$J(m.deleteDialog).dialog("open")}else{$J(m.nonCancelableDialog).dialog("open")}}else{$J(m.noneSelectedDialog).dialog("open")}};$J(this.deleteConfirmButton).click(function(q){$J(m.formAction).val("DELETE");showWait();$J(m.deleteDialog).dialog("close");$J(m.submitButton)[0].click()});$J(this.deleteCancelButton).click(function(q){$J(m.deleteDialog).dialog("close")});$J(this.nonCancelableButton).click(function(q){$J(m.nonCancelableDialog).dialog("close")});$J(this.nonEditableDialog).dialog({autoOpen:false,modal:true,zIndex:1000});$J(this.editButton).click(function(q){o()});$J(this.topEditButton).click(function(q){o()});var o=function(){if(n()){var t=true;if(!a){$J(m.readyCheckBoxes).each(function(v,w){if(w.checked!=""){t=false}})}if(t){var u="";var s;for(var r=0;r<m.docIds.length;r++){u+=encodeAsTapestry(m.docIds[r])+"/"}var q=m.editHoldsUrl.replace("-docIdsHere-",u.substring(0,u.length-1));if($J("#placeHold").size()==0){$J(m.containerSelector).append("<div id='placeHold' style='display: none'/>")}$J("#placeHold").dialog({autoOpen:true,title:"Edit Holds",width:"535",height:"310",minHeight:"330",modal:true,resizable:false,dynamicLoad:true,dynamicSource:q}).bind("dialogclose",function(){window.location=m.reloadUrl})}else{$J(m.nonEditableDialog).dialog("open")}}else{$J(m.noneSelectedDialog).dialog("open")}};$J(this.suspendDialog).dialog({autoOpen:false,modal:true,zIndex:1000});$J(this.cancelSuspendDialog).dialog({autoOpen:false,modal:true,zIndex:1000});$J(this.suspendButton).click(function(q){l()});$J(this.topSuspendButton).click(function(q){l()});var l=function(){if(n()){var q=true;if(!a){$J(m.readyCheckBoxes).each(function(r,s){if(s.checked!=""){q=false}})}if(q){$J(m.suspendDialog).dialog("open")}else{$J(m.nonEditableDialog).dialog("open")}}else{$J(m.noneSelectedDialog).dialog("open")}};$J(this.suspendCancelButton).click(function(q){$J(m.suspendDialog).dialog("close")});$J(this.suspendConfirmButton).click(function(q){$J(m.formAction).val("SUSPEND");date=$J("#"+d+"_suspendStartDate").datepicker("getDate");if(date!=null&&document.getElementById(d+"_suspendStartDate")){$J(m.startDate).val((date.getMonth()+1)+"/"+date.getDate()+"/"+date.getFullYear())}else{$J(m.startDate).val(null)}date=$J("#"+d+"_suspendEndDate").datepicker("getDate");if(date!=null&&document.getElementById(d+"_suspendEndDate")){$J(m.endDate).val((date.getMonth()+1)+"/"+date.getDate()+"/"+date.getFullYear())}else{$J(m.endDate).val(null)}showWait();$J(m.suspendDialog).dialog("close");$J(m.submitButton).click()});$J(this.noneSelectedButton).click(function(q){$J(m.noneSelectedDialog).dialog("close")});$J(this.nonEditableButton).click(function(q){$J(m.nonEditableDialog).dialog("close")});$J(this.cancelSuspendButton).click(function(q){k()});$J(this.topCancelSuspendButton).click(function(q){k()});var k=function(){if(n()){var q=true;if(!a){$J(m.readyCheckBoxes).each(function(r,s){if(s.checked!=""){q=false}})}if(q){$J(m.cancelSuspendDialog).dialog("open")}else{$J(m.nonEditableDialog).dialog("open")}}else{$J(m.noneSelectedDialog).dialog("open")}};$J(this.cancelSuspendCancelButton).click(function(q){$J(m.cancelSuspendDialog).dialog("close")});$J(this.cancelSuspendConfirmButton).click(function(q){$J(m.formAction).val("CANCELSUSPEND");showWait();$J(m.cancelSuspendDialog).dialog("close");$J(m.submitButton).click()});var e=$J("#"+d+"_suspendStartDate").datepicker({minDate:"0",changeMonth:true,numberOfMonths:2,onSelect:function(s){var t="minDate",q=$J(this).data("datepicker"),r=$J.datepicker.parseDate(q.settings.dateFormat||$J.datepicker._defaults.dateFormat,s,q.settings);r.setDate(r.getDate()+1);j.datepicker("option",t,r)},dateFormat:this.dateFormat});var j=$J("#"+d+"_suspendEndDate").datepicker({minDate:"1",changeMonth:true,numberOfMonths:2,onSelect:function(s){var t="maxDate",q=$J(this).data("datepicker"),r=$J.datepicker.parseDate(q.settings.dateFormat||$J.datepicker._defaults.dateFormat,s,q.settings);r.setDate(r.getDate()-1);e.datepicker("option",t,r)},dateFormat:this.dateFormat})}};function showWait(){var b=$J(".loadingDiv");if(b.length<1){b=$J("<div></div>").addClass("loadingDiv")}parent.$J("#myHolds").append(b);var a=$J(".loadingBackdrop");if(a.length<1){a=$J("<div></div>").addClass("loadingBackdrop")}parent.$J("#myHolds").append(a);a.show();b.show();createSpinnersForSelector(b)}var eRC_Base={ercIds:[],ercTitleData:{},titleWaitingCallbacks:[],titlesReady:false,titleAjaxCallsOut:0,addErcId:function(b,a){if(b){eRC_Base.ercIds.push({ercId:b,resultId:a})}},loadTheData:function(){var b="";for(var c=0;c<eRC_Base.ercIds.length;c++){var d=eRC_Base.ercIds[c];if(b.indexOf(d)===-1){b+=","+d.ercId}}if(b.length>0){b=b.substr(1)}if(b){var a=addPathParams(com_sirsi_ent_widgets.URLS.eRC.titleInfoUrl,encodeAsTapestry(b));eRC_Base.titleAjaxCallsOut++;new AjaxHandler(null,a,null,eRC_Base.handleTitlesResponse,null,true).invokeAjax()}else{eRC_Base.titlesReady=true}},handleTitlesResponse:function(a){eRC_Base.titleAjaxCallsOut--;if(eRC_Base.ercTitleData.eResourceList){a.responseJSON.eResourceList.forEach(function(f){eRC_Base.ercTitleData.eResourceList.push(f)})}else{eRC_Base.ercTitleData=a.responseJSON}eRC_Base.titlesReady=true;var d=[];for(var b=0;b<eRC_Base.titleWaitingCallbacks.length;b++){var e=eRC_Base.titleWaitingCallbacks[b];var c=eRC_Base.getData(e.ercId);if(c||eRC_Base.titleAjaxCallsOut==0){e.callback(c)}else{d.push(e)}}eRC_Base.titleWaitingCallbacks=d},getSingleTitle:function(a){var b=addPathParams(com_sirsi_ent_widgets.URLS.eRC.titleInfoUrl,encodeAsTapestry(a));eRC_Base.titleAjaxCallsOut++;new AjaxHandler(null,b,null,eRC_Base.handleTitlesResponse,null,true).invokeAjax()},getData:function(b){if(!b){return}if(eRC_Base.ercTitleData&&eRC_Base.ercTitleData.eResourceList){var c=eRC_Base.ercTitleData.eResourceList;for(var a=0;a<c.length;a++){if(c[a].id==b){return c[a]}}}eRC_Base.getSingleTitle(b)},getErcId:function(a,c){if(!a){return}for(var d=0;d<eRC_Base.ercIds.length;d++){var b=eRC_Base.ercIds[d];if(b.resultId==a){return b.ercId}}if(!c){eRC_Base.addErcId(a);return eRC_Base.getErcId(a,true)}},getTitleData:function(b,a){var c;if(eRC_Base.titlesReady){c=eRC_Base.getData(eRC_Base.getErcId(a))}if(c){b(c)}else{eRC_Base.titleWaitingCallbacks.push({callback:b,ercId:eRC_Base.getErcId(a)})}},getAccountsResponse:function(b,c){var a=addPathParams(com_sirsi_ent_widgets.URLS.eRC.accountsUrl,encodeAsTapestry(c));new AjaxHandler(null,a,null,function(d){b(d.responseJSON)},null,true).invokeAjax()},getDownloadResponse:function(b,a,d){var c=addPathParams(com_sirsi_ent_widgets.URLS.eRC.getEResourceUrl,encodeAsTapestry(a)+"/"+!!d);new Ajax.Request(c,{onSuccess:function(e){b(e.responseJSON)},onException:Tapestry.ajaxFailureHandler,onFailure:Tapestry.ajaxFailureHandler,asynchronous:false})},getPlaceHoldResponse:function(b,a,d){var e=d.split("@");var c=addPathParams(com_sirsi_ent_widgets.URLS.eRC.placeHoldUrl,encodeAsTapestry(eRC_Base.getErcId(a))+"/"+e[0]+"/"+e[1]);new AjaxHandler(null,c,null,function(f){b(f.responseJSON)},null,true).invokeAjax()},getHoldEmail:function(c,a){var b=addPathParams(com_sirsi_ent_widgets.URLS.eRC.emailHoldUrl,encodeAsTapestry(eRC_Base.getErcId(a)));new AjaxHandler(null,b,null,function(d){c(d.responseJSON)},null,true).invokeAjax()}};$J(function(){eRC_Base.loadTheData()});var eRC_Dialogs={shownFormatCount:4,messageDialogTimeoutMS:10000,dialogButtonClass:"ercDialogButton",primaryButtonClass:"ercPrimaryButton",secondaryButtonClass:"ercSecondaryButton",formatDialogClass:"ercFormatDialog",previewDialogClass:"ercPreviewDialog",durationId:"ercCurrentDays",formatDivId:"ercFormatDiv",formatDivClass:"ercFormatDiv",formatRadioId:"ercFormatRadioDiv",radioName:"ercRadioGroup",radioClass:"ercRadio",msgDialogId:"ercMessageDialog",messageClass:"ercMessage",accountDialogClass:"ercAccountsDialog",accountErrorDiv:"ercAcctErrorDiv",accountFormClass:"ercAccountsForm",accountDivClass:"ercAccountDiv",accountLabelClass:"ercAccountLabel",accountSelectClass:"ercAccountSelect",accountInputClass:"ercAccountInput",makeId:function(b,a){return b+"_"+a},makeError:function(a){return{status:"error",error:a}},showLoad:function(){var b=$J(".loadingDiv");if(b.length<1){b=$J("<div></div>").addClass("loadingDiv");$J("body").append(b)}var a=$J(".loadingBackdrop");if(a.length<1){a=$J("<div></div>").addClass("loadingBackdrop");$J("body").append(a)}a.show();b.show();createSpinnersForSelector(b)},hideLoad:function(){$J(".loadingBackdrop").hide();$J(".loadingDiv").hide();stopSpinnersForSelector($J(".loadingDiv"))},findFormatDialog:function(g,b,f,e){if(!f){eRC_Dialogs.openErrorMessageDialog(g,eRC_Dialogs.makeError(ercWidgetStrings.ERC_DIALOGS.ERC_NO_ITEM_DATA));return}var a=e?f.previews:f.formats;if(!a||a.length<1){eRC_Dialogs.openErrorMessageDialog(g,eRC_Dialogs.makeError(ercWidgetStrings.ERC_DIALOGS.ERC_NO_FORMATS));return}if(a.length===1){eRC_Dialogs.hideLoad();g(a[0],f.drm,true);return}var d=eRC_Dialogs.makeId(e?eRC_Dialogs.previewDialogClass:eRC_Dialogs.formatDialogClass,b);var c=document.getElementById(d);if(!c){eRC_Dialogs.showLoad();c=eRC_Dialogs.buildFormatDialog(d,f,b,e)}c.setAttribute("value","");$J(c).unbind("dialogclose").bind("dialogclose",function(h){eRC_Dialogs.getFormat(g,$J(c).attr("value"))});eRC_Dialogs.hideLoad();$J(c).dialog("open")},buildFormatDialog:function(j,d,f,a){var g=a?d.previews:d.formats;var i=eRC_Dialogs.buildFormatDiv(j,g,f,a);var e=document.createElement("div");e.setAttribute("id",j);e.setAttribute("class",(a?eRC_Dialogs.previewDialogClass:eRC_Dialogs.formatDialogClass)+" ercDialog");e.appendChild(i);if(g.length>eRC_Dialogs.shownFormatCount){e.appendChild(eRC_Dialogs.buildExpanderHandle(j))}var c=document.createElement("div");c.setAttribute("class","ercDialogButtonsDiv");var h=document.createElement("input");h.setAttribute("type","button");h.setAttribute("id",j+"_okButton");h.setAttribute("class",eRC_Dialogs.primaryButtonClass+" "+eRC_Dialogs.dialogButtonClass);h.setAttribute("onclick","javascript:$J('#"+j+"').attr('value', eRC_Dialogs.getRadioFormat('"+j+"')); $J('#"+j+"').dialog('close');");h.setAttribute("value",a?ercWidgetStrings.ERC_DIALOGS.ERC_PREVIEW:(d.drm?ercWidgetStrings.ERC_DIALOGS.ERC_CHECKOUT:ercWidgetStrings.ERC_DIALOGS.ERC_DOWNLOAD));c.appendChild(h);var b=document.createElement("input");b.setAttribute("type","button");b.setAttribute("id",j+"_cancelButton");b.setAttribute("class",eRC_Dialogs.secondaryButtonClass+" "+eRC_Dialogs.dialogButtonClass);b.setAttribute("onclick","javascript:$J('#"+j+"').dialog('close');");b.setAttribute("value",ercWidgetStrings.ERC_DIALOGS.ERC_CANCEL);c.appendChild(b);e.appendChild(c);document.body.appendChild(e);$J(e).dialog({autoOpen:false,title:a?ercWidgetStrings.ERC_DIALOGS.ERC_PREVIEW_OPTS:(d.drm?ercWidgetStrings.ERC_DIALOGS.ERC_CHECKOUT_OPTS:ercWidgetStrings.ERC_DIALOGS.ERC_DOWNLOAD_OPTS),modal:true,resizable:false});return e},buildFormatDiv:function(q,j,h,b){var e=eRC_Dialogs.makeId(q,eRC_Dialogs.formatDivId);var n=document.createElement("div");n.setAttribute("id",e);for(var f=0;f<j.length;f++){var p=eRC_Dialogs.makeId(eRC_Dialogs.radioClass,eRC_Dialogs.makeId(q,f));var c=document.createElement("input");c.setAttribute("type","radio");c.setAttribute("name",eRC_Dialogs.makeId(eRC_Dialogs.radioName,q));c.setAttribute("id",p);c.setAttribute("class",eRC_Dialogs.radioClass);c.setAttribute("value",(b?"prev:":"down:")+h+":"+j[f].key);if(f===0){c.setAttribute("checked","checked")}var k=document.createElement("label");var m="ercRadioLabel";if(j[f].totalCopies&&!j[f].availableCopies){c.setAttribute("disabled","disabled");m+=" disabledLabel"}k.setAttribute("class",m);k.setAttribute("for",p);var d=j[f].name;if(j[f].description){d+=" - "+j[f].description}k.innerHTML=d;var l=document.createElement("div");l.setAttribute("id",eRC_Dialogs.makeId(eRC_Dialogs.formatRadioId,eRC_Dialogs.makeId(q,f)));var o=eRC_Dialogs.formatDivClass+" "+eRC_Dialogs.makeId(q,eRC_Dialogs.formatDivClass);if(f>=eRC_Dialogs.shownFormatCount){o+=" hidden"}l.setAttribute("class",o);l.appendChild(c);l.appendChild(k);if(f>0){var a=document.createElement("hr");var g="ercFormatSep";if(f>=eRC_Dialogs.shownFormatCount){g+=" hidden"}a.setAttribute("class",g);n.appendChild(a)}n.appendChild(l)}return n},getEmailHold:function(a,f){if(eRC_Dialogs.overDriveHold==false){return"not@overdrive"}var b=$J("#"+eRC_Dialogs.makeId(a,eRC_Dialogs.holdDivId+" ."+a+"_emailInput")).attr("value");var d=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/;var e=d.test(b);if(e===true){return b}else{if($J(".emailError").length==0){var c=document.createElement("span");c.setAttribute("class","emailError");$J("#"+eRC_Dialogs.makeId(a,eRC_Dialogs.holdDivId)).before(c);$J(".emailError").text(ercWidgetStrings.ERC_DIALOGS.ERC_EMAIL_ERROR)}return""}},buildExpanderHandle:function(b){var a=b+"_expander";var c=document.createElement("div");c.setAttribute("id",a);c.setAttribute("class","ercFormatExpander");c.setAttribute("onclick","$J('#"+eRC_Dialogs.makeId(b,eRC_Dialogs.formatDivClass)+" .hidden').each(function() { $J(this).removeClass(\"hidden\"); }); $J('#"+a+"').hide();");c.innerHTML="<span class='ercExpanderLabel'>ercWidgetStrings.ERC_DIALOGS.ERC_EXPAND_LABEL</span>";return c},getRadioFormat:function(a){var b;$J("#"+eRC_Dialogs.makeId(a,eRC_Dialogs.formatDivId+" ."+eRC_Dialogs.radioClass)).each(function(){if(this.checked){b=$J(this).attr("value")}});return b},getFormat:function(e,b){var c=b.substring(0,b.indexOf(":"));b=b.substring(b.indexOf(":")+1);var a=b.substring(0,b.indexOf(":"));var d=b.substring(b.indexOf(":")+1);eRC_Base.getTitleData(function(g){if(g){var f=(c=="prev")?g.previews:g.formats;for(var h=0;h<f.length;h++){if(f[h].key==d){e(f[h],g.drm);return}}}e()},a)},getSpecificAccountInputsClass:function(a){return eRC_Dialogs.accountInputClass+a},findAccountsDialog:function(h,c,e,d,a){if(d&&d.error){eRC_Dialogs.openErrorMessageDialog(h,d);return}if(!(d&&d.accountType&&d.accountType.length>0)){eRC_Dialogs.openErrorMessageDialog(h,eRC_Dialogs.makeError(ercWidgetStrings.ERC_DIALOGS.ERC_BAD_ACCT_RESPONSE));return}var g=e.key+c;var j=eRC_Dialogs.accountDialogClass+g;var f=document.getElementById(j);if(!f){eRC_Dialogs.showLoad();f=eRC_Dialogs.buildAccountDialog(g,j,e,d,a)}for(var b=0;b<d.accountType.length;b++){eRC_Dialogs.fillAccountSelectionOptions(g,d.accountType[b])}$J(f).unbind("dialogclose").bind("dialogclose",function(i){h($J(f).attr("value"))});f.removeAttribute("value");$J("."+eRC_Dialogs.accountErrorDiv).hide();eRC_Dialogs.hideLoad();$J(f).dialog("open")},buildAccountDialog:function(n,o,k,j,e){var f=document.createElement("div");f.setAttribute("id",eRC_Dialogs.accountErrorDiv+n);f.setAttribute("class",eRC_Dialogs.accountErrorDiv);f.setAttribute("style","display: none;");f.innerHTML=ercWidgetStrings.ERC_DIALOGS.ERC_ACCT_VALIDATION_ERROR;var m=eRC_Dialogs.accountFormClass+n;var c=document.createElement("form");c.setAttribute("id",m);c.setAttribute("class",eRC_Dialogs.accountFormClass);c.setAttribute("onsubmit","javascript: eRC_Dialogs.handleAccountFormSubmit('"+n+"', '"+k.url+"'); return false;");var b=[];for(var g=0;g<j.accountType.length;g++){var h=JSON.parse(JSON.stringify(j.accountType[g]));if(k.authentication.ereaderAccount===h.key){h.type="ereaderAccount"}if(k.authentication.partnerAccount===h.key){h.type="partnerAccount"}if(!h.type){return null}if(h.externalAccountUrl){b.push(h)}var d=eRC_Dialogs.buildAccountDiv(n,h,g>0);if(d){c.appendChild(d)}}var a=eRC_Dialogs.buildDurationSelector(n,e);if(a){c.appendChild(a)}c.appendChild(eRC_Dialogs.buildAccountButtonsDiv(b));var l=document.createElement("div");l.setAttribute("id",o);l.setAttribute("class",eRC_Dialogs.accountDialogClass+" ercDialog");l.appendChild(f);l.appendChild(c);document.body.appendChild(l);$J(l).dialog({autoOpen:false,title:ercWidgetStrings.ERC_DIALOGS.ERC_GENERAL_ACCOUNT_TITLE,modal:true,resizable:false});$J("#"+m+" select").each(function(){this.selectedIndex=-1});$J("#"+eRC_Dialogs.accountErrorDiv+n).hide();return l},buildAccountDiv:function(o,i,e){if(!(i&&i.key)){return null}com_sirsi_ent_strings.setStringFormatFunc_JavaStyle();var k=eRC_Dialogs.makeId(o,i.key);var d=document.createElement("div");d.setAttribute("id",eRC_Dialogs.accountDivClass+k);d.setAttribute("class",eRC_Dialogs.accountDivClass);if(e){var h=document.createElement("hr");h.setAttribute("class","ercAccountsSep");d.appendChild(h)}var p=document.createElement("h3");p.setAttribute("class","ercAcctDialogHeading");p.innerHTML=String.format(ercWidgetStrings.ERC_DIALOGS.ERC_ACCOUNT_TITLE,i.name);d.appendChild(p);var n=eRC_Dialogs.accountInputClass+k;var m=document.createElement("label");m.setAttribute("for",n);m.setAttribute("class",eRC_Dialogs.accountLabelClass);m.innerHTML=ercWidgetStrings.ERC_DIALOGS.ERC_ACCT_MANUAL_ID_LABEL;d.appendChild(m);var a=eRC_Dialogs.accountSelectClass+k;var f=document.createElement("select");f.setAttribute("id",a);f.setAttribute("tabindex",-1);f.setAttribute("class",eRC_Dialogs.accountSelectClass);f.setAttribute("onchange","javascript:document.getElementById('"+n+"').value=document.getElementById('"+a+"').value;");var l=document.createElement("input");l.setAttribute("id",n);l.setAttribute("class","ercAccountSelectInput "+eRC_Dialogs.getSpecificAccountInputsClass(o));l.setAttribute("type","text");l.setAttribute("name",i.type);l.setAttribute("autocomplete","off");$J(l).keyup(function(q){if(q&&q.keyCode==40){$J(f).focus().click()}f.selectedIndex=-1});var g=document.createElement("div");g.appendChild(f);g.appendChild(l);d.appendChild(g);if(true===i.passwordRequired){var j="ercAccountPasswordField"+k;var c=document.createElement("label");c.setAttribute("for",j);c.setAttribute("class",eRC_Dialogs.accountLabelClass);c.innerHTML=ercWidgetStrings.ERC_DIALOGS.ERC_ACCT_PASSWORD_LABEL;d.appendChild(c);var b=document.createElement("input");b.setAttribute("type","password");b.setAttribute("id",j);b.setAttribute("class",eRC_Dialogs.accountInputClass+" "+eRC_Dialogs.getSpecificAccountInputsClass(o));b.setAttribute("name",i.type+"Pw");d.appendChild(b)}com_sirsi_ent_strings.resetString_dot_format();return d},buildDurationSelector:function(m,c){if(!(c&&c.maxCheckout)){return null}var e=document.createElement("div");e.setAttribute("id","ercCheckout_"+m);e.setAttribute("class","ercCheckoutDiv");var h=c.defaultCheckout?c.defaultCheckout:c.maxCheckout;var f=eRC_Dialogs.makeId(eRC_Dialogs.durationId,m);var k=document.createElement("div");k.setAttribute("class","ercCheckoutLabel");k.innerHTML=ercWidgetStrings.ERC_DIALOGS.ERC_DURATION;e.appendChild(k);var j=document.createElement("span");j.setAttribute("id",f);j.innerHTML=h;var l=document.createElement("div");l.setAttribute("class","ercCheckoutSelection");l.innerHTML=ercWidgetStrings.ERC_DIALOGS.ERC_DAYS;l.insertBefore(j,l.childNodes[0]);if(c.maxCheckout===c.minCheckout){e.appendChild(l)}else{var d=c.minCheckout?c.minCheckout:1;var n=document.createElement("span");n.setAttribute("class","ercMinDays");n.innerHTML=d;var g=document.createElement("span");g.setAttribute("class","ercMaxDays");g.innerHTML=c.maxCheckout;var i="ercSelector_"+m;var b=document.createElement("div");b.setAttribute("id",i);b.setAttribute("class","checkoutTimeSelector");var a=document.createElement("div");a.setAttribute("class","ercCheckoutSlider");a.appendChild(n);a.appendChild(g);a.appendChild(b);a.appendChild(l);e.appendChild(a);$J(b).slider({min:d,max:c.maxCheckout,value:h,slide:function(o,p){document.getElementById(f).innerHTML=p.value}})}return e},buildAccountButtonsDiv:function(d){com_sirsi_ent_strings.setStringFormatFunc_JavaStyle();var f=document.createElement("div");f.setAttribute("class","ercDialogButtonsDiv");var e=document.createElement("input");e.setAttribute("type","submit");e.setAttribute("class",eRC_Dialogs.primaryButtonClass+" "+eRC_Dialogs.dialogButtonClass);e.setAttribute("value",ercWidgetStrings.ERC_DIALOGS.ERC_OK_BUTTON);f.appendChild(e);for(var b=0;b<d.length;b++){var a='javascript: window.open("'+d[b].externalAccountUrl+'", "_blank"); return false;';var c=document.createElement("button");c.setAttribute("class",eRC_Dialogs.secondaryButtonClass+" "+eRC_Dialogs.dialogButtonClass);c.setAttribute("onclick",a);c.innerHTML=String.format(ercWidgetStrings.ERC_DIALOGS.ERC_NEW_ACCOUNT,d[b].name);f.appendChild(c)}com_sirsi_ent_strings.resetString_dot_format();return f},fillAccountSelectionOptions:function(a,e){var g=eRC_Dialogs.makeId(a,e.key);var c=document.getElementById(eRC_Dialogs.accountSelectClass+g);while(c.hasChildNodes()){c.removeChild(c.lastChild)}for(var b=0;b<e.account.length;b++){var f=e.account[b];var d=document.createElement("option");d.setAttribute("value",f.id);if(f.isDefault){document.getElementById(eRC_Dialogs.accountInputClass+g).value=f.id}d.innerHTML=f.id;c.appendChild(d)}c.selectedIndex=-1;$J("#"+eRC_Dialogs.accountDivClass+g+" input").first().select()},handleAccountFormSubmit:function(a,c){var d=c+"?";var b=true;$J("."+eRC_Dialogs.getSpecificAccountInputsClass(a)).each(function(){var f=this.value;if(f){d+=this.getAttribute("name")+"="+f+"&"}else{$J("#"+eRC_Dialogs.accountErrorDiv+a).show();b=false}});if(b){var e=document.getElementById(eRC_Dialogs.makeId(eRC_Dialogs.durationId,a));if(e&&e.innerHTML){d+="duration="+e.innerHTML+"&"}document.getElementById(eRC_Dialogs.accountDialogClass+a).setAttribute("value",d.substring(0,d.length-1));$J("#"+eRC_Dialogs.accountDialogClass+a).dialog("close")}},openFormatDialog:function(c,a,b){if(!(a&&"function"===typeof c)){eRC_Dialogs.openErrorMessageDialog(c,eRC_Dialogs.makeError(ercWidgetStrings.ERC_DIALOGS.ERC_ILLEGAL_ARGUMENT+': "callback", "resultId"'));return}eRC_Dialogs.showLoad();eRC_Base.getTitleData(function(d){eRC_Dialogs.findFormatDialog(c,a,d,b)},a)},openEmailDialog:function(c,a,b){if(!(a&&"function"===typeof c)){eRC_Dialogs.openErrorMessageDialog(c,eRC_Dialogs.makeError(ercWidgetStrings.ERC_DIALOGS.ERC_ILLEGAL_ARGUMENT+': "callback", "resultId"'));return}if(b.id.indexOf("OVERDRIVE")==0){eRC_Dialogs.overDriveHold=true;eRC_Base.getHoldEmail(function(d){eRC_Dialogs.findHoldDialog(c,a,b,d)},a)}else{eRC_Dialogs.overDriveHold=false;eRC_Dialogs.findHoldDialog(c,a,b)}},openAccountDialog:function(f,a,e,d){var b=e&&e.key&&e.url&&e.authentication;if(!(a&&b&&"function"===typeof f)){eRC_Dialogs.openErrorMessageDialog(f,eRC_Dialogs.makeError(ercWidgetStrings.ERC_DIALOGS.ERC_ILLEGAL_ARGUMENT+': "callback", "resultId", "format"'));return}var c=e.authentication;if(!(c.partnerAccount||c.ereaderAccount)){f(e.url);return}if(!(c.accountsUrl)){eRC_Dialogs.openErrorMessageDialog(f,eRC_Dialogs.makeError(ercWidgetStrings.ERC_DIALOGS.ERC_NO_ACCOUNTS_URL));return}eRC_Dialogs.showLoad();eRC_Base.getAccountsResponse(function(g){eRC_Dialogs.findAccountsDialog(f,a,e,g,d)},c.accountsUrl)},openMessageDialog:function(h,f,a,g){if(!(f&&a&&a.message)){eRC_Dialogs.openErrorMessageDialog(h,eRC_Dialogs.makeError(ercWidgetStrings.ERC_DIALOGS.ERC_ILLEGAL_ARGUMENT+': "resultId", "messageInfo"'));return}eRC_Dialogs.closeMessageDialog(f);eRC_Dialogs.showLoad();var i=eRC_Dialogs.makeId(eRC_Dialogs.messageClass,f);var d=document.getElementById(i);if(!d){d=document.createElement("div");d.setAttribute("id",i);var c=document.createElement("a");c.setAttribute("class",eRC_Dialogs.primaryButtonClass+" "+eRC_Dialogs.dialogButtonClass);c.setAttribute("href","#");c.setAttribute("onclick","javascript:eRC_Dialogs.closeMessageDialog('"+f+"');");c.innerHTML=ercWidgetStrings.ERC_DIALOGS.ERC_CLOSE;d.appendChild(c);if(g){var b=document.createElement("a");b.setAttribute("class",eRC_Dialogs.secondaryButtonClass+" "+eRC_Dialogs.dialogButtonClass);b.setAttribute("href","http://www.sirsidynix.com/eReader-Downloads");b.innerHTML=ercWidgetStrings.ERC_DIALOGS.ERC_EREADERS_LINK;d.appendChild(b)}document.body.appendChild(d)}var e=eRC_Dialogs.makeId(eRC_Dialogs.messageClass,f);var j=document.getElementById(e);if(!j){j=document.createElement("div");j.setAttribute("id",e);j.setAttribute("class",eRC_Dialogs.messageClass);d.insertBefore(j,d.childNodes[0])}j.innerHTML=a.message;eRC_Dialogs.hideLoad();$J("#"+i).unbind("dialogclose").bind("dialogclose",h).dialog({autoOpen:true,title:a.title?a.title:"",dialogClass:eRC_Dialogs.formatDialogClass,modal:true,resizable:false})},closeMessageDialog:function(a){if(a){$J("#"+eRC_Dialogs.makeId(eRC_Dialogs.messageClass,a)).dialog("close")}},openErrorMessageDialog:function(b,a){if(a.error){$J("."+eRC_Dialogs.messageClass).each(function(){$J(this).dialog("close")});eRC_Dialogs.openMessageDialog(function(){if("function"===typeof b){b(a)}},"ercErrorDialog",{title:ercWidgetStrings.ERC_DIALOGS.ERC_ERROR_TITLE,message:a.error})}else{if("function"===typeof b){b(a)}}},closeErrorMessageDialog:function(a){eRC_Dialogs.closeMessageDialog(a)}};var eRC_DownloadButton={reloadNeeded:true,ercDownloadButtonClass:"ercDownloadButton",addButtonToResult:function(a){eRC_Base.getTitleData(function(b){eRC_DownloadButton.addValidButton(a,b)},a)},handleDownloadButtonClick:function(a,b,c){if(b){com_sirsi_ent_login.loginFirst(function(d){eRC_DownloadButton.reloadNeeded=d;eRC_Dialogs.openFormatDialog(function(f,e){eRC_DownloadButton.handleFormatResponse(a,f,e,c)},a)});return}eRC_Dialogs.openFormatDialog(function(e,d){eRC_DownloadButton.handleFormatResponse(a,e,d,c)},a)},handleFormatResponse:function(a,c,b,d){if(c&&!c.error){eRC_Dialogs.openAccountDialog(function(e){eRC_DownloadButton.handleAccountDialogResponse(a,e,d)},a,c,b)}else{if(eRC_DownloadButton.reloadNeeded){window.location.reload()}}},handleAccountDialogResponse:function(a,b,c){if(b&&!b.error){eRC_Dialogs.showLoad();eRC_Base.getDownloadResponse(function(d){eRC_DownloadButton.handleCheckoutResponse(a,d)},b,c)}else{eRC_Dialogs.openFormatDialog(function(f,e,d){if(d){if(eRC_DownloadButton.reloadNeeded){window.location.reload()}}else{eRC_DownloadButton.handleFormatResponse(a,f,e,c)}},a)}},handleCheckoutResponse:function(a,b){com_sirsi_ent_strings.setStringFormatFunc_JavaStyle();var f=ercWidgetStrings.ERC_DOWNLOAD.ERC_ERROR_TITLE;var d;var e=function(){};var c;if(!b||b.error){c=true;d=b.error?b.error:ercWidgetStrings.ERC_DOWNLOAD.ERC_ERROR_MESSAGE;if(b&&b.description){d+="<br/><br/>"+b.description}}else{if("SYNC"===b.action){f=ercWidgetStrings.ERC_DOWNLOAD.ERC_CHECKOUT_TITLE;d=b.message.value}else{if("DOWNLOAD"===b.action){f=ercWidgetStrings.ERC_DOWNLOAD.ERC_DOWNLOAD_TITLE;d=ercWidgetStrings.ERC_DOWNLOAD.ERC_DOWNLOAD_MESSAGE;e=function(){open(b.url,"_blank")}}else{if("REDIRECT"===b.action){f=ercWidgetStrings.ERC_DOWNLOAD.ERC_REDIRECT_TITLE;d=ercWidgetStrings.ERC_DOWNLOAD.ERC_REDIRECT_MESSAGE;e=function(){open(b.url,"_blank")}}else{c=true;d=String.format(ercWidgetStrings.ERC_DOWNLOAD.ERC_MISSING_CHECKOUT_ACTION,b.action)}}}}com_sirsi_ent_strings.resetString_dot_format();eRC_Dialogs.hideLoad();eRC_Dialogs.openMessageDialog(function(){if(eRC_DownloadButton.reloadNeeded){window.location.reload()}},a,{message:d,title:f},b&&"SYNC"===b.action);if(!c&&eRC_Dialogs.messageDialogTimeoutMS){setTimeout(function(){eRC_Dialogs.closeMessageDialog(a)},eRC_Dialogs.messageDialogTimeoutMS)}e()}};var PayFines=Class.create();PayFines.prototype={initialize:function(a,l,c,m,k,b,h,d){var g=this;this.total=l;this.perm=l;this.mainDiv="#div_"+a;this.checkBoxes="input[id^=nfc_"+a+"]";this.creditArea=".creditArea";this.creditTotal=".creditTotal";this.selectBox="input[id^=payFinesSelect_"+a+"]";this.fineValue="#fineValue_"+a;this.fineValueDisplay="#fineValue_"+a+"_display";this.amount="#amount_"+a;this.customData="#customData_"+a;this.customCredit="*[name=customCredit_"+a+"]";this.apply="#apply_"+a;this.currencyPlaces=c;this.minimumPayment=m;this.minPaymentErrorMsg=k;this.multiplier=1;this.selectAll=b;this.confirmCredit=h;this.formatMoneyEventLink=d;this.updateFineValueDisplay=function(p){var i=addPathParams(d,p);new Ajax.Request(i,{method:"post",onSuccess:function(q){var r=q.responseText.evalJSON(true);$J(g.fineValueDisplay).val(r.formatted)},onFailure:function(){$J(g.fineValueDisplay).val($J(g.fineValue).val())}})};for(var e=0;e<c;e++){this.multiplier=this.multiplier*10}this.isCredit=false;var j={};var f={};$J(this.checkBoxes).each(function(p,r){r.checked="checked";var q=$J("#hiddenkey"+r.name).val();var i=$J("#hiddenname"+r.name).val();var s=parseFloat($J("#hidden"+r.name).val());if(f[i]==null){f[i]=0;j[i]=new Array()}f[i]=g.addDelta(f[i],s);j[i].push(q)});if($J(this.checkBoxes).length>0){var o=$J(this.customData);o.val(this.replaceCustomData(o.val(),f,j));var n=$J(this.customCredit);n.val(this.replaceCustomData(n.val(),f,j))}$J(this.checkBoxes).click(function(s){var r=s.target;var t=parseFloat($J("#hidden"+r.name).val());var u=$J("#hiddenkey"+r.name).val();var i=$J("#hiddenname"+r.name).val();var q=g.total;if(r.checked){g.total=Math.round((q+t)*1000)/1000;var v=$J(g.customCredit);var x=$J(g.customData);if(x.val()!=null){x.val(g.addKey(x.val(),i,t,u))}if(v.val()!=null){v.val(g.addKey(v.val(),i,t,u))}var p=true;$J(g.checkBoxes).each(function(y,z){if(!z.disabled&&!z.checked){p=false}});if(p){$J(g.selectBox).each(function(y,z){z.checked="checked"})}}else{g.total=Math.round((q-t)*1000)/1000;var v=$J(g.customCredit);var x=$J(g.customData);if(x.val()){x.val(g.removeKey(x.val(),i,t,u))}if(v.val()){v.val(g.removeKey(v.val(),i,t,u))}$J(g.selectBox).each(function(y,z){z.checked=""})}$J(g.amount).val(g.total);var w=g.padCurrencyForDisplay(g.total);$J(g.fineValue).val(w);g.updateFineValueDisplay(w)});$J(this.fineValue).change(function(r){var t=parseFloat(r.target.value);if(isNaN(t)||t<0){t=0}t=Math.round(t*g.multiplier)/g.multiplier;var i=g.perm;var p=t;if(t<i){$J(g.selectBox).each(function(y,z){z.checked=""})}if(t>=i){$J(g.selectBox).each(function(y,z){z.checked="checked"})}var u=0;var s={};var q={};$J(g.checkBoxes).each(function(z,B){var C=parseFloat($J("#hidden"+B.name).val());var A=$J("#hiddenkey"+B.name).val();var y=$J("#hiddenname"+B.name).val();if(p>=C){if(s[y]==null){s[y]=new Array();q[y]=0}B.checked="checked";p=Math.round((p-C)*1000)/1000;u=Math.round((u+C)*1000)/1000;s[y].push(A);q[y]=g.addDelta(q[y],C)}else{B.checked=""}});var x=$J(g.customData);var v=$J(g.customCredit);x.val(g.replaceCustomData(x.val(),q,s));v.val(g.replaceCustomData(v.val(),q,s));t=u;g.total=t;$J(g.amount).val(t);var w=g.padCurrencyForDisplay(t);$J(g.fineValue).val(w);g.updateFineValueDisplay(w)});$J(this.selectBox).click(function(t){if(!this.checked){$J(g.checkBoxes).each(function(w,x){if(!x.disabled){x.checked=""}});$J(g.selectBox).each(function(w,x){x.checked=""});$J(g.creditArea).addClass("hidden");var r=g.padCurrencyForDisplay(0);$J(g.creditTotal).html(r);g.total=0;$J(g.amount).val(0);$J(g.fineValue).val(r);g.updateFineValueDisplay(r);var v=$J(g.customData);v.val(g.replaceCustomData(v.val(),{},{}));var s=$J(g.customCredit);s.val(g.replaceCustomData(s.val(),{},{}))}else{var u={};var p={};$J(g.checkBoxes).each(function(x,z){if(!z.disabled){z.checked="checked"}var y=$J("#hiddenkey"+z.name).val();var w=$J("#hiddenname"+z.name).val();var A=parseFloat($J("#hidden"+z.name).val());if(p[w]==null){p[w]=0;u[w]=new Array()}p[w]=g.addDelta(p[w],A);u[w].push(y)});$J(g.selectBox).each(function(w,x){x.checked="checked"});$J(g.creditArea).addClass("hidden");$J(g.creditTotal).html(g.padCurrencyForDisplay(0));var i=g.perm;g.total=i;$J(g.amount).val(i);var q=g.padCurrencyForDisplay(i);$J(g.fineValue).val(q);g.updateFineValueDisplay(q);var v=$J(g.customData);v.val(g.replaceCustomData(v.val(),p,u));var s=$J(g.customCredit);s.val(g.replaceCustomData(s.val(),p,u))}});$J(this.apply).click(function(){g.isCredit=true});$J(g.mainDiv+" .paypalForm, "+g.mainDiv+" .applyCreditForm").submit(function(){return g.validatePayment(a)});$J(g.mainDiv+" input[id^=apply]").click(function(){var i=$J(g.amount).val();if(typeof(i)=="undefined"){i=$J(g.fineValue).val()}return i>0&&confirm(g.confirmCredit)})},validatePayment:function(b){if(termsAndConditionsObject[b].termsAndConditionsEnabled&&!$J("#"+termsAndConditionsObject[b].checkboxId).attr("checked")){showTCNotAcceptedError();return false}var a=$J(this.amount).val();if(typeof(a)=="undefined"){a=$J(this.fineValue).val()}if(this.minimumPayment&&a<this.minimumPayment){alert(this.minPaymentErrorMsg);return false}return true},padCurrencyForDisplay:function(b){var a=Math.round(b*this.multiplier)%this.multiplier;var e=a;for(var d=1;d<this.currencyPlaces;d++){if(a<this.multiplier/(d*10)){e="0"+e}}var c=Math.floor(b);return c+"."+e},addKey:function(c,f,h,j){var e=c.split("|");var b=e[0];var a={};var k=false;for(var g=1;g<e.length;g++){var d=e[g].split("~");if(d[0]==f){k=true;b+="|"+d[0]+"~"+this.addDelta(d[1],h)+"~"+this.addKeyToValue(d[2],j)}else{b+="|"+e[g]}}if(!k){return b+"|"+f+"~"+h+"~"+j}else{return b}},addKeyToValue:function(b,a){if(b){if(b.length>0){return b+","+a}else{return a}}return a},addDelta:function(a,b){return Math.round((parseFloat(a)+b)*1000)/1000},removeKey:function(c,f,j,k){var e=c.split("|");var b=e[0];var a={};for(var g=1;g<e.length;g++){var d=e[g].split("~");if(d[0]==f){var h=this.removeKeyFromVal(d[2],k);if(h.length!=0){b+="|"+d[0]+"~"+this.removeDelta(d[1],j)+"~"+h}}else{b+="|"+e[g]}}return b},removeKeyFromVal:function(c,b){if(c){var d=c.split(",");for(var a=0;a<d.length;a++){if(d[a]==b){d.splice(a,1);return d.join()}}}return c},removeDelta:function(a,b){return Math.round((a-b)*1000)/1000},replaceCustomData:function(f,a,e){if(f!=null){var d=f.split("|");var c=d[0];for(var b in a){c+="|"+b+"~"+a[b]+"~"+e[b].join(",")}return c}}};var generalFinesList=new Object();function setGeneralFinesObject(b,a){generalFinesList[b]=a}var termsAndConditionsObject=new Object();function setTermsAndConditionsObject(d,c,a,b){termsAndConditionsObject[d]=new Object();termsAndConditionsObject[d].checkboxId=c;termsAndConditionsObject[d].termsAndConditionsEnabled=b;termsAndConditionsObject.OkButtonLabel=a}function verifyThenSubmit(c){if(termsAndConditionsObject[c].termsAndConditionsEnabled&&!$J("#"+termsAndConditionsObject[c].checkboxId).attr("checked")){showTCNotAcceptedError();return}if(!generalFinesList[c]||generalFinesList[c].validatePayment(c)){var b=$J("#customData_"+c).val();var a=addPathParams(preparePaypalUrl,encodeAsTapestry(b)+"/"+encodeAsTapestry(c));new AjaxHandler(null,a,null,verificationHandler,null,true).invokeAjax()}}function verificationHandler(a){var c=a.responseText.evalJSON();if(c.error){var b=$J("#error_"+c.id);b.text(c.error);b.show();return}$J("#customData_"+c.id).val(c.custom);$J("#submit_"+c.id).click()}function updateRedirectUrl(c,b){var a=b;var n=document.getElementById("customData_"+c).value;var o=n.split("|");var m=0;var p="";for(var g=0;g<o.length;g++){var k=o[g];if(k){var e=k.split("~");var j=e[0];var h=e[1];var l=e[2];m+=Number(h);var f=l.split(",");for(var d=0;d<f.length;d++){if(p.length>0){p=p+";"}p=p+f[d]+":"+j}}}a=a+"&bills="+p;a=a+"&amount="+m;a=a+"&currCode="+currCode;return a}function goToPayProPage(b,g,f,a,c,d){if(g&&f&&a&&c){var e=updateRedirectUrl(f,a);e=addPathParams(g,encodeAsTapestry(e)+"/"+encodeAsTapestry(d)+"/"+encodeAsTapestry("580px")+"/"+encodeAsTapestry(false)+"/"+encodeAsTapestry(c)+"/"+encodeAsTapestry(b));window.location=e}}function showTermsAndConditions(){$J("#TermsAndConditionsDiv").dialog({width:500,minWidth:500,height:500,minHeight:500,resizable:false,draggable:false,autoOpen:true,modal:true,buttons:[{id:"okButton",text:termsAndConditionsObject.OkButtonLabel,click:function(){$J(this).dialog("close")}}]})}function showTCNotAcceptedError(){$J("#AcceptTermsAndConditionsDiv").dialog({autoOpen:true,modal:true,buttons:[{id:"okButton",text:termsAndConditionsObject.OkButtonLabel,click:function(){$J(this).dialog("close")}}]})}var Account=Class.create();Account.prototype={startPanel1:0,startPanel2:0,startPanel3:0,initialize:function(e,d,a,b){var c=e==0?d:0;this.startPanel1=e==1?d:b;this.startPanel2=e==2?d:b;this.startPanel3=e==3?d:0;if(a&&a.length>0){$J("#"+a).focus()}$J("#accountTabs").tabs({selected:e});$J("#summaryCheckouts").click(function(){$J("#accountTabs").tabs("select",1)});$J("#summaryHolds").click(function(){$J("#accountTabs").tabs("select",2)});$J("#summaryFines").click(function(){$J("#accountTabs").tabs("select",3)});$J("#preferencesAccordion").accordion({autoHeight:false,collapsible:true,active:c});$J("#myAccount").show()}};function makeSortable(a){if(a==null){return}if(typeof(sorttable)=="undefined"){go_go_gadget_sorttable()}sorttable.makeSortable(a)}function updateHoldsItems(b){var d=b.responseText.evalJSON();var a=d.array;if(!a){return}for(var c=0;c<a.length;c++){var e=a[c];if("image" in e){jQuery("#holdInitialCover_"+e.identifier+" img").attr("src",e.image);jQuery("#holdInitialCover_"+e.identifier+" .no_image_text").hide()}if("itemID" in e){jQuery("#holdItemIdSpan_"+e.identifier).attr("innerHTML",e.itemID)}}}function updateCheckoutsItems(a){var b=a.responseText.evalJSON();var e=b.array;if(!e){return}for(var d=0;d<e.length;d++){var c=e[d];if("image" in c){jQuery("#checkoutInitialCover_"+c.identifier+" img").attr("src",c.image);jQuery("#checkoutInitialCover_"+c.identifier+" .no_image_text").hide()}}};