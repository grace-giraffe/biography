!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.LDClient=t()}(this,function(){"use strict";var e,t=(function(e,t){!function(){var e=t,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var t,o,a=String(e),i=0,u=n,s="";a.charAt(0|i)||(u="=",i%1);s+=u.charAt(63&t>>8-i%1*8)){if((o=a.charCodeAt(i+=.75))>255)throw new r("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|o}return s}),e.atob||(e.atob=function(e){var t=String(e).replace(/[=]+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,a,i=0,u=0,s="";a=t.charAt(u++);~a&&(o=i%4?64*o+a:a,i++%4)?s+=String.fromCharCode(255&o>>(-2*i&6)):0)a=n.indexOf(a);return s})}()}(e={exports:{}},e.exports),e.exports),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function r(e){return t.btoa(unescape(encodeURIComponent(e)))}function o(e){return r(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function a(e){return JSON.parse(JSON.stringify(e))}function i(e){setTimeout(e,0)}function u(e,t){var n=e.then(function(e){return t&&setTimeout(function(){t(null,e)},0),e},function(e){if(!t)return Promise.reject(e);setTimeout(function(){t(e,null)},0)});return t?void 0:n}function s(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]={value:e[n],version:0});return t}function c(e){e.setRequestHeader("X-LaunchDarkly-User-Agent","JSClient/2.1.2")}function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(e,t){return n({},e,t)},{})}var v=2e3;function f(e,t,n,r){var a=void 0,i=e+"/events/bulk/"+t,u=e+"/a/"+t+".gif",s={};function l(e,t){var n=new Image;t&&n.addEventListener("load",t),n.src=e}function f(e,t,n){var a=r||l,s=function(r){if(t){var s=new XMLHttpRequest;s.open("POST",i,!n),c(s),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("X-LaunchDarkly-Event-Schema","3"),n||s.addEventListener("load",function(){r(function(e){var t={status:e.status},n=e.getResponseHeader("Date");if(n){var r=Date.parse(n);r&&(t.serverTime=r)}return t}(s))}),s.send(JSON.stringify(e))}else{var l=u+"?d="+o(JSON.stringify(e));a(l,n?null:r)}};if(!n)return new Promise(function(e){s(e)});s()}return s.sendEvents=function(t,r){void 0===a&&(a=void 0===n?"withCredentials"in new XMLHttpRequest:n);var i=void 0!==r&&r,u=void 0;u=a?[t]:function(e,t){for(var n=t.slice(0),r=[],a=e,i=void 0;n.length>0;){for(i=[];a>0;){var u=n.shift();if(!u)break;(a-=o(JSON.stringify(u)).length)<0&&i.length>0?n.unshift(u):i.push(u)}a=e,r.push(i)}return r}(v-e.length,t);for(var s=[],c=0;c<u.length;c++)s.push(f(u[c],a,i));return r?Promise.resolve():Promise.all(s)},s}var d=" Please see https://docs.launchdarkly.com/docs/js-sdk-reference#section-initializing-the-client for instructions on SDK initialization.",p=function(){return"localStorage is unavailable"},g=function(e){return'Custom event "'+e+'" does not exist'},y=function(){return"environment not found."+d},h=function(){return"No environment specified."+d},m=function(e){return"Error fetching flag settings: "+(e.message||e)},k=function(){return"No user specified."+d},w=function(){return"Invalid user specified."+d},b=function(e,t){return'[LaunchDarkly] "'+e+'" is deprecated, please use "'+t+'"'};function E(e){var t={},n=void 0!==e.allAttributesPrivate?e.allAttributesPrivate:e.all_attributes_private,r=(void 0!==e.privateAttributeNames?e.privateAttributeNames:e.private_attribute_names)||[],o={key:!0,custom:!0,anonymous:!0},a={key:!0,secondary:!0,ip:!0,country:!0,email:!0,firstName:!0,lastName:!0,avatar:!0,name:!0,anonymous:!0,custom:!0};return void 0!==e.all_attributes_private&&console&&console.warn&&console.warn(b("all_attributes_private","allAttributesPrivate")),void 0!==e.private_attribute_names&&console&&console.warn&&console.warn(b("private_attribute_names","privateAttributeNames")),t.filterUser=function(e){if(!e)return null;var t=e.privateAttributeNames||[],i=function(e,a){return Object.keys(e).reduce(function(i,u){var s=i;return a(u)&&(!function(e){return!o[e]&&(n||-1!==t.indexOf(e)||-1!==r.indexOf(e))}(u)?s[0][u]=e[u]:s[1][u]=!0),s},[{},{}])},u=i(e,function(e){return a[e]}),s=u[0],c=u[1];if(e.custom){var v=i(e.custom,function(){return!0});s.custom=v[0],c=l({},c,v[1])}var f=Object.keys(c);return f.length&&(f.sort(),s.privateAttrs=f),s},t}function S(e){function t(e,t){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.message=e,this.code=t}return t.prototype=new Error,t.prototype.name=e,t.prototype.constructor=t,t}var N=S("LaunchDarklyUnexpectedResponseError"),D=S("LaunchDarklyInvalidEnvironmentIdError"),O=S("LaunchDarklyInvalidUserError"),R=S("LaunchDarklyInvalidEventKeyError"),T=S("LaunchDarklyInvalidArgumentError"),U=S("LaunchDarklyFlagFetchError");function L(e,t){var n,r,o,a,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v={},d=c||f(e,t),p=(r=0,o=0,a={},(n={}).summarizeEvent=function(e){if("feature"===e.kind){var t=e.key+":"+(null!==e.variation&&void 0!==e.variation?e.variation:"")+":"+(null!==e.version&&void 0!==e.version?e.version:""),n=a[t];n?n.count=n.count+1:a[t]={count:1,key:e.key,variation:e.variation,version:e.version,value:e.value,default:e.default},(0===r||e.creationDate<r)&&(r=e.creationDate),e.creationDate>o&&(o=e.creationDate)}},n.getSummary=function(){var e={},t=!0;for(var n in a){var i=a[n],u=e[i.key];u||(u={default:i.default,counters:[]},e[i.key]=u);var s={value:i.value,count:i.count};void 0!==i.variation&&null!==i.variation&&(s.variation=i.variation),i.version?s.version=i.version:s.unknown=!0,u.counters.push(s),t=!1}return t?null:{startDate:r,endDate:o,features:e}},n.clearSummary=function(){r=0,o=0,a={}},n),g=E(u),y=!!u.inlineUsersInEvents,h=[],m=void 0,k=void 0,w=0,b=!1,S=void 0;function D(e){i(function(){s&&s.maybeReportError(new T(e))})}function O(){return 0===k||0===Math.floor(Math.random()*k)}return void 0!==u.samplingInterval&&(isNaN(u.samplingInterval)||u.samplingInterval<0)?(k=0,D("Invalid sampling interval configured. Sampling interval must be an integer >= 0.")):k=u.samplingInterval||0,void 0!==u.flushInterval&&(isNan(u.flushInterval)||u.flushInterval<2e3)?(m=2e3,D("Invalid flush interval configured. Must be an integer >= 2000 (milliseconds).")):m=u.flushInterval||2e3,v.enqueue=function(e){if(!b){var t,n=!1,r=!1;if(p.summarizeEvent(e),"feature"===e.kind?O()&&(n=!!e.trackEvents,r=!!(t=e).debugEventsUntilDate&&t.debugEventsUntilDate>w&&t.debugEventsUntilDate>(new Date).getTime()):n=O(),n&&h.push(function(e){var t=l({},e);return y||"identify"===e.kind?t.user=g.filterUser(e.user):(t.userKey=e.user.key,delete t.user),"feature"===e.kind&&(delete t.trackEvents,delete t.debugEventsUntilDate),t}(e)),r){var o=l({},e,{kind:"debug"});delete o.trackEvents,delete o.debugEventsUntilDate,delete o.variation,h.push(o)}}},v.flush=function(e){if(b)return Promise.resolve();var t=h,n=p.getSummary();return p.clearSummary(),n&&(n.kind="summary",t.push(n)),0===t.length?Promise.resolve():(h=[],d.sendEvents(t,e).then(function(e){e&&(e.serverTime&&(w=e.serverTime),401===e.status&&(b=!0,i(function(){s.maybeReportError(new N("Received 401 error, no further events will be posted"))})))}))},v.start=function(){S=setTimeout(function e(){v.flush(),S=setTimeout(e,m)},m)},v.stop=function(){clearTimeout(S)},v}function x(){var e={},t={};return e.on=function(e,n,r){t[e]=t[e]||[],t[e]=t[e].concat({handler:n,context:r})},e.off=function(e,n,r){if(t[e])for(var o=0;o<t[e].length;o++)t[e][o].handler===n&&t[e][o].context===r&&(t[e]=t[e].slice(0,o).concat(t[e].slice(o+1)))},e.emit=function(e){if(t[e])for(var n=0;n<t[e].length;n++)t[e][n].handler.apply(t[e][n].context,Array.prototype.slice.call(arguments,1))},e.maybeReportError=function(e){e&&(t["error"]?this.emit("error",e):console.error(e.message))},e}var I=/[|\\{}()[\]^$+*?.]/g,P=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(I,"\\$&")};function A(e,t,n,r){var o=t.replace(n,"").replace(r,""),a=void 0,i=void 0;switch(e.kind){case"exact":i=t,a=new RegExp("^"+P(e.url)+"/?$");break;case"canonical":i=o,a=new RegExp("^"+P(e.url)+"/?$");break;case"substring":i=o,a=new RegExp(".*"+P(e.substring)+".*$");break;case"regex":i=o,a=new RegExp(e.pattern);break;default:return!1}return a.test(i)}function C(e,t){for(var n={},r=null,o=[],a=0;a<e.length;a++)for(var i=e[a],u=i.urls||[],s=0;s<u.length;s++)if(A(u[s],location.href,location.search,location.hash)){"pageview"===i.kind?t("pageview",i):(o.push(i),t("click_pageview",i));break}return o.length>0&&(r=function(e){for(var n=function(e,t){for(var n=[],r=0;r<t.length;r++)for(var o=e.target,a=t[r],i=a.selector,u=document.querySelectorAll(i);o&&u.length>0;){for(var s=0;s<u.length;s++)o===u[s]&&n.push(a);o=o.parentNode}return n}(e,o),r=0;r<n.length;r++)t("click",n[r])},document.addEventListener("click",r)),n.dispose=function(){document.removeEventListener("click",r)},n}var F="application/json";function j(e,t,n){var r=new XMLHttpRequest;return r.addEventListener("load",function(){200===r.status&&r.getResponseHeader("Content-type")&&0===r.getResponseHeader("Content-Type").lastIndexOf(F)?n(null,JSON.parse(r.responseText)):n(r.statusText)}),r.addEventListener("error",function(){404===r.status&&n(new D(y())),n(r.statusText)}),t?(r.open("REPORT",e),r.setRequestHeader("Content-Type","application/json"),c(r),r.send(JSON.stringify(t))):(r.open("GET",e),c(r),r.send()),r}function J(e,t){var n={},r=void 0;return n.setUser=function(e){r=function(e){var t=a(e);return t.key&&(t.key=t.key.toString()),t}(e),t(a(r))},n.getUser=function(){return r?a(r):null},e&&n.setUser(e),n}var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q="ready",H="change",$=300;return{initialize:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.baseUrl||"https://app.launchdarkly.com",c=n.eventsUrl||"https://events.launchdarkly.com",v=n.streamUrl||"https://clientstream.launchdarkly.com",f=n.hash,d=void 0===n.sendEvents||n.sendEvents,y=!!n.allowFrequentDuplicateEvents,b=!!n.sendEventsOnlyForVariation,E=e,S=x(),T=function(e,t,n,r){var a={},i=e+"/eval/"+t+"/",u=null;return a.connect=function(a,s){if("undefined"!=typeof EventSource){var c=void 0;for(var l in r?c=e+"/ping/"+t:(c=i+o(JSON.stringify(a)),null!=n&&(c=c+"?h="+n)),u=new window.EventSource(c),s)s.hasOwnProperty(l)&&u.addEventListener(l,s[l])}},a.disconnect=function(){u&&u.close()},a.isConnected=function(){return u&&(u.readyState===EventSource.OPEN||u.readyState===EventSource.CONNECTING)},a}(v,E,f,n.useReport),I=n.eventProcessor||L(c,E,n,S),P=function(e,t,n){var r=void 0,a=void 0,i={fetchFlagSettings:function(i,u,s){var c=void 0,l=void 0,v=void 0,f=void 0;n?(l=[e,"/sdk/evalx/",t,"/user",u?"?h="+u:""].join(""),v=i):(c=o(JSON.stringify(i)),l=[e,"/sdk/evalx/",t,"/users/",c,u?"?h="+u:""].join(""));var d,p,g=(d=s,function(e,t){d(e,t),r=null,a=null});r?(r.abort(),p=a,f=function(){p&&p.apply(null,arguments),g.apply(null,arguments)}):f=g,a=f,r=j(l,v,f)},fetchGoals:function(n){j([e,"/sdk/goals/",t].join(""),null,n)}};return i}(a,E,n.useReport),A={},F="object"===_(n.bootstrap)?s(n.bootstrap):{},M=void 0,z=void 0,G=void 0,X=void 0,B=!0;function K(){return d&&(e=void 0,!("1"===(e=navigator&&void 0!==navigator.doNotTrack?navigator.doNotTrack:navigator&&void 0!==navigator.msDoNotTrack?navigator.msDoNotTrack:window.doNotTrack)||"yes"===e));var e}function V(e){e.user?(B=!1,K()&&I.enqueue(e)):B&&(console&&console.warn&&console.warn("Be sure to call `identify` in the LaunchDarkly client: http://docs.launchdarkly.com/docs/running-an-ab-test#include-the-client-side-snippet"),B=!1)}var Y=J(t,function(e){e&&V({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()})}),Q=function(e,t,n){var o={};function a(){var o="",a=n.getUser();return a&&(o=t||r(JSON.stringify(a))),"ld:"+e+":"+o}return o.loadFlags=function(){var e=a(),t=void 0,n=void 0;try{t=localStorage.getItem(e)}catch(e){return console.warn(p()),null}try{n=JSON.parse(t)}catch(e){return o.clearFlags(),null}if(n){var r=n.$schema;(void 0===r||r<1)&&(n=s(n))}return n},o.saveFlags=function(e){var t=a(),n=l({},e,{$schema:1});try{localStorage.setItem(t,JSON.stringify(n))}catch(e){console.warn(p())}},o.clearFlags=function(){var e=a();try{localStorage.removeItem(e)}catch(e){}},o}(E,f,Y);function W(e,t,n){var r=Y.getUser(),o=new Date;if(!y){var a=JSON.stringify(t)+(r&&r.key?r.key:"")+e,i=A[a];if(i&&o-i<3e5)return;A[a]=o}var u={kind:"feature",key:e,user:r,value:t,default:n,creationDate:o.getTime()},s=F[e];s&&(u.version=s.flagVersion?s.flagVersion:s.version,u.variation=s.variation,u.trackEvents=s.trackEvents,u.debugEventsUntilDate=s.debugEventsUntilDate),V(u)}function Z(e,t){var n={kind:e,key:t.key,data:null,url:window.location.href,user:Y.getUser(),creationDate:(new Date).getTime()};return"click"===e&&(n.selector=t.selector),V(n)}function ee(e,t,n){var r=void 0;return r=F&&F.hasOwnProperty(e)&&F[e]&&!F[e].deleted?null===F[e].value?t:F[e].value:t,n&&W(e,r,t),r}function te(){Y.getUser()&&(T.disconnect(),T.connect(Y.getUser(),{ping:function(){P.fetchFlagSettings(Y.getUser(),f,function(e,t){e&&S.maybeReportError(new U(m(e))),ne(t)})},put:function(e){ne(JSON.parse(e.data))},patch:function(e){var t=JSON.parse(e.data),n=F[t.key];if(!n||!n.version||!t.version||n.version<t.version){var r={},o=l({},t);delete o.key,F[t.key]=o,r[t.key]=n?{previous:n.value,current:t.value}:{current:t.value},re(r)}},delete:function(e){var t=JSON.parse(e.data);if(!F[t.key]||F[t.key].version<t.version){var n={};F[t.key]&&!F[t.key].deleted&&(n[t.key]={previous:F[t.key].value}),F[t.key]={version:t.version,deleted:!0},re(n)}}}))}function ne(e){var t={};if(e){for(var n in F)F.hasOwnProperty(n)&&F[n]&&(e[n]&&e[n].value!==F[n].value?t[n]={previous:F[n].value,current:e[n].value}:e[n]&&!e[n].deleted||(t[n]={previous:F[n].value}));for(var r in e)e.hasOwnProperty(r)&&e[r]&&(!F[r]||F[r].deleted)&&(t[r]={current:e[r].value});F=e,re(t)}}function re(e){var t=Object.keys(e);z&&Q.saveFlags(F),t.length>0&&(t.forEach(function(t){S.emit(H+":"+t,e[t].current,e[t].previous)}),S.emit(H,e),b||t.forEach(function(t){W(t,e[t].current)}))}function oe(){M&&M.dispose(),G&&G.length&&(M=C(G,Z))}function ae(){d&&I.start()}e||i(function(){S.maybeReportError(new D(h()))}),t?t.key||i(function(){S.maybeReportError(new O(w()))}):i(function(){S.maybeReportError(new O(k()))}),"object"===_(n.bootstrap)?i(function(){S.emit(q)}):"string"==typeof n.bootstrap&&"LOCALSTORAGE"===n.bootstrap.toUpperCase()&&localStorage?(z=!0,null===(F=Q.loadFlags())?P.fetchFlagSettings(Y.getUser(),f,function(e,t){e&&S.maybeReportError(new U(m(e))),t?(F=t,Q.saveFlags(F)):F={},S.emit(q)}):(i(function(){S.emit(q)}),P.fetchFlagSettings(Y.getUser(),f,function(e,t){e&&S.maybeReportError(new U(m(e))),t&&Q.saveFlags(t)}))):P.fetchFlagSettings(Y.getUser(),f,function(e,t){e&&S.maybeReportError(new U(m(e))),F=t,S.emit(q)}),P.fetchGoals(function(e,t){e&&S.maybeReportError(new N((e.message,e.message))),t&&t.length>0&&(M=C(G=t,Z),function(e,t){var n=location.href,r=void 0;function o(){(r=location.href)!==n&&(n=r,t())}!function e(t,n){t(),setTimeout(function(){e(t,n)},n)}(o,e),window.history&&history.pushState?window.addEventListener("popstate",o):window.addEventListener("hashchange",o)}($,oe))}),"complete"!==document.readyState?window.addEventListener("load",ae):ae(),window.addEventListener("beforeunload",function(){d&&(I.stop(),I.flush(!0))}),window.addEventListener("message",function(e){if(e.origin===a&&"SYN"===e.data.type){window.editorClientBaseUrl=a;var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=a+e.data.editorClientUrl;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}});var ie=new Promise(function(e){var t=S.on(q,function(){S.off(q,t),e()})});return{waitUntilReady:function(){return ie},identify:function(e,t,n){return z&&Q.clearFlags(),u(new Promise(function(n,r){if(e&&null!==e.key&&void 0!==e.key)Y.setUser(e),P.fetchFlagSettings(Y.getUser(),t,function(e,t){if(e)return S.maybeReportError(new U(m(e))),r(e);t&&ne(t),n(t),X&&te()});else{var o=new O(e?w():k());S.maybeReportError(o),r(o)}}),n)},variation:function(e,t){return ee(e,t,!0)},track:function(e,t){"string"==typeof e?(G&&!function(e){if(!G||0===G.length)return!1;for(var t=0;t<G.length;t++)if("custom"===G[t].kind&&G[t].key===e)return!0;return!1}(e)&&console.warn(g(e)),V({kind:"custom",key:e,data:t,user:Y.getUser(),url:window.location.href,creationDate:(new Date).getTime()})):S.maybeReportError(new R(g(e)))},on:function(e,t,n){e.substr(0,H.length)===H?(X=!0,T.isConnected()||te(),S.on.apply(S,[e,t,n])):S.on.apply(S,Array.prototype.slice.call(arguments))},off:function(e){e===H&&(X=!0)&&(X=!1,T.disconnect()),S.off.apply(S,Array.prototype.slice.call(arguments))},flush:function(e){return u(new Promise(function(e){return d?e(I.flush()):e()},e))},allFlags:function(){var e={};if(!F)return e;for(var t in F)F.hasOwnProperty(t)&&(e[t]=ee(t,null,!b));return e}}},version:"2.1.2"}});
//# sourceMappingURL=ldclient.min.js.map
